<!DOCTYPE html>
<html lang="en">
<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script>
    //helper method for making the text inside the html
    const messageText = (content, type, status, text, resText) => {
      content.innerHTML = ``;
      console.log(resText);
      if(type === "application/json"){
        const resObj = JSON.parse(resText);
        text.innerText = `Message: ${resObj.message}`;
      }else if(type === "text/xml"){
        const parsedXML = new window.DOMParser().parseFromString(resText, 'text/xml');
        text.innerText = `Message: ${parsedXML.querySelector('message')}`
      };

        content.appendChild(status);
        content.appendChild(text);
      }
    const handleResponse = async (response, fileType) => {
      //document query selectors
      const content = document.querySelector("#content");

      //create elements
      const siteStatus = document.createElement("h1");
      const message = document.createElement("p");

      response.text().then(resText => {
      switch(response.status){
            //success
            case 200: 
              siteStatus.innerHTML = `<b>Success</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //bad request
            case 400: 
              siteStatus.innerHTML = `<b>Bad Request</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //unauthorized
            case 401:
              siteStatus.innerHTML = `<b>Unauthorized</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //forbidden
            case 403:
              siteStatus.innerHTML = `<b>Forbidden</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //not found
            case 404:
              siteStatus.innerHTML = `<b>Resource Not Found</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //Internal
            case 500:
              siteStatus.innerHTML = `<b>Internal Server Error</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //Not Implemented
            case 501:
              siteStatus.innerHTML = `<b>Not Implemented</b>`;
              messageText(content, fileType, siteStatus, message, resText);
              break;

            //no error code
            default: 
              content.innerHTML = `Error code not implemented by client.`;
              break;
      }
      })
    };

    const requestUpdate = async (top) => {
      //grabs the value of the current html selectors
      const page = top.querySelector("#page").value;
      const type = top.querySelector("#type").value;

      let response = await fetch(page, {
        method: 'GET',
        headers:{
          'Accept': type,
        },
      });

      //second paramter determines how we parse out our response
      handleResponse(response, type);
    };

    const init = () => {
        const userTypes = document.querySelector("#userTypes");

        const getForm = (e) => {
          e.preventDefault();
          requestUpdate(userTypes);
          return false;
        }

        userTypes.addEventListener('submit', getForm);
    }

    window.onload = init;
  </script>
</head>
<body>
  <section id="top">
    <h3>Status Code Tests</h3>
      <form id="userTypes">
        <select id="page">
          <option value="/success">Success</option> <!-- 200 -->
          <option value="/badRequest">Bad Request</option> <!-- 400 -->
          <option value="/unauthorized">Unauthorized</option> <!-- 401 -->
          <option value="/forbidden">Forbidden</option> <!-- 403 -->
          <option value="/internal">Internal</option> <!-- 500 -->
          <option value="/notImplemented">Not Implemented</option> <!-- 501 -->
          <option value="/notFound">Not Found</option> <!-- 404 -->
        </select>
        <select id="type">
          <option value="application/json">JSON</option>
          <option value="text/xml">XML</option>
        </select>
        <button id="send">Send</button>
      </form>
  </section>
  <section id="content">
  </section>
</body>
</html>
